# 암복호화 키 저장 방식 비교 보고서

## 1. 개요
애플리케이션에서 Jasypt를 사용해 데이터를 암복호화할 때, 키를 단순한 `.dat` 파일로 보관하는 방식은 파일 유출 시 키 자체가 노출되어 심각한 보안 위험을 초래할 수 있습니다.  
본 보고서에서는 **파일 기반 키 저장·관리 방식** 중 보안성, 운영 편의성, 유출 시 리스크 관점에서 주요 방안을 정리·비교합니다.

## 2. 고려 가능 방안

1. **Java KeyStore (JCEKS)**
   - 확장자: `.jceks`  
   - 설명: JCE(Java Cryptography Extension)에서 제공하는 KeyStore 형식. 대칭키 보관에 최적화되어 있으며, JKS보다 강력한 암호화(PBKDF2, AES)를 지원.

2. **PKCS#12 Keystore**
   - 확장자: `.p12` / `.pfx`  
   - 설명: 국제 표준 PKCS#12 포맷. 개인키, 공개키, 인증서를 한 번에 저장 가능. 다양한 플랫폼/언어 간 호환성 우수.

3. **GPG 대칭 암호화**
   - 확장자: `.gpg`  
   - 설명: 파일 전체를 AES256 등으로 대칭 암호화. 복호화 비밀번호를 별도 관리.

4. **GPG 비대칭 암호화**
   - 확장자: `.asc` (또는 `.gpg`)  
   - 설명: 공개키로 암호화, 개인키로만 복호화. 개인키를 안전한 장소에 보관(예: 하드웨어 토큰).

5. **하드웨어 보안 모듈 (HSM) / PKCS#11**
   - 확장자: 없음 (모듈 인터페이스)  
   - 설명: 키를 HSM 내부에 저장·연산. 키가 외부로 노출되지 않으며, 물리적 보안 강력.

6. **클라우드 키 관리 서비스 (KMS)**
   - 확장자: 없음 (REST/API)  
   - 설명: AWS KMS, Azure Key Vault, GCP Cloud KMS 등. 키를 서비스 제공자 인프라에 안전하게 보관·관리.

7. **OS 네이티브 키 저장소**
   - 예) Windows DPAPI, macOS Keychain, Linux Kernel Keyring  
   - 설명: 운영체제 수준에서 제공하는 키 저장소에 키를 보관.

## 3. 비교 표

| 방식                     | 파일/인터페이스       | 암호화 알고리즘     | 키 유형     | 보호 수단           | 통합 난이도 | 유출 시 리스크                                    | 장 점                                                         | 단 점                                                       |
|------------------------|-------------------|-----------------|-----------|------------------|-----------|------------------------------------------------|------------------------------------------------------------|-----------------------------------------------------------|
| JCEKS                  | `.jceks`           | PBKDF2 & AES    | 대칭키     | 키스토어 비밀번호     | ★★☆☆☆    | 키스토어 비밀번호 유출 시 전체 키 복호화 가능             | Java 표준, 대칭키 저장 최적화, 설정 간편                                    | 비밀번호 관리 필요, 외부 연동 제한적                        |
| PKCS#12                | `.p12`/`.pfx`      | AES             | 대/비대칭  | 키스토어 비밀번호     | ★★☆☆☆    | 비밀번호 유출 시 개인키·대칭키 모두 노출 가능             | 플랫폼 간 호환성, 인증서 포함 가능                                        | 비밀번호 관리 필요, 구조 복잡                             |
| GPG 대칭 암호화         | `.gpg`             | AES256          | 대칭키     | 복호화 비밀번호       | ★☆☆☆☆    | 비밀번호 노출 시 파일 완전 복호화 가능                  | 간단한 파일 암호화, 스크립트 통합 용이                                     | 비밀번호 관리 번거, 키 순환 관리 수작업                     |
| GPG 비대칭 암호화        | `.asc`/`.gpg`      | RSA + AES256    | 비대칭     | 공개키/개인키 쌍      | ★★★☆☆    | 개인키 유출 시 전체 복호화 가능                        | 개인키 외부 보관으로 안전, 사용자별 권한 관리 가능                          | 키 쌍 관리 복잡, 성능 저하 가능                           |
| HSM / PKCS#11          | 모듈 인터페이스      | HSM 지원 알고리즘 | 대/비대칭  | HSM 내부 보관        | ★★★★☆    | 물리적 탈취 시 위험, 논리적 유출 거의 불가               | 키 절대 비노출, 물리 보안·감사 로깅 제공                                  | 비용 발생, 운용·통합 복잡                                  |
| 클라우드 KMS            | REST/API           | AES256          | 대칭키     | 서비스 제공자 보관     | ★★★☆☆    | API 자격증명 탈취 시 위험, 네트워크 의존                  | 중앙 집중식 관리·감사, 자동 키 순환 지원                                  | 외부 서비스 의존, 레이턴시 발생 가능                       |
| OS 네이티브 키스토어      | OS 키스토어 API    | OS별 상이       | 대칭키     | OS 계정 권한          | ★★★☆☆    | OS 권한 획득 시 노출 가능                                | 별도 인프라 불필요, OS 인증·권한 연동                                    | 플랫폼 종속적, Java 연동 추가 코드 필요                   |

## 4. 결론 및 권장 사항

1. **단순 파일 저장(`.dat`) → 키스토어 전환**  
   - `.jceks` 또는 `.p12` 기반의 Java KeyStore 활용을 우선 검토하세요.  
   - 키스토어 비밀번호는 **환경 변수**나 **OS 네이티브 키스토어**에 숨겨 관리하고, 애플리케이션 시작 시 주입하는 방식이 안전합니다.

2. **고급 보안이 필요할 경우**  
   - **HSM/PKCS#11** 모듈을 도입하거나  
   - **클라우드 KMS** 연동을 통해 키를 외부 인프라에 안전하게 위임하는 방안을 추천합니다.

3. **운영·관리 고려사항**  
   - 비밀번호(또는 API 자격증명) 관리 정책(암호 복잡도, 순환 주기 등)을 수립하세요.  
   - 키 유출 사고 대응을 위해 **키 순환(rotating)** 및 **접근 감사(logging)** 체계를 마련해야 합니다.

> **추가 팁:**  
> - Jasypt에서는 `StringEncryptor` 빈을 직접 생성해 KeyStore에서 키를 읽도록 확장할 수 있습니다.  
> - Spring Boot 3.x 기준으로 `spring.config.import=key-store:classpath:/keystore.jceks[secret=mySecret]` 형식의 네이티브 지원을 참고하세요.  
> - Vault나 AWS KMS를 연동할 경우, 애플리케이션 컴포넌트가 키값을 메모리에만 보관하고 파일에 남기지 않도록 구현할 수 있습니다.
