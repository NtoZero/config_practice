# π― JASYPT ν‚¤μ¤ν† μ–΄ λ§μ΄κ·Έλ μ΄μ… μ™„λ£ λ³΄κ³ μ„ v2.0

## π“… μ‘μ—… μ™„λ£ μΌμ‹
**μ™„λ£ μΌμ‹**: 2025λ…„ 6μ›” 25μΌ  
**λ§μ΄κ·Έλ μ΄μ… λ²„μ „**: v1.0 β†’ v2.0  
**μ‘μ—…μ**: AI Assistant  
**λ¬Έμ„ λ²„μ „**: 2.0

---

## β… λ§μ΄κ·Έλ μ΄μ… μ„±κ³µ μ”μ•½

### π”‘ ν•µμ‹¬ λ³€κ²½μ‚¬ν•­
| ν•­λ© | λ³€κ²½ μ „ (v1.0) | λ³€κ²½ ν›„ (v2.0) | μƒνƒ |
|------|----------------|----------------|------|
| **JASYPT μ•”νΈν™” ν‚¤** | ν‚¤μ¤ν† μ–΄ λΉ„λ°€λ²νΈ μ§μ ‘ μ‚¬μ© | ν‚¤μ¤ν† μ–΄ λ‚΄λ¶€ κ°μΈν‚¤ μ¶”μ¶ μ‚¬μ© | β… μ™„λ£ |
| **ν™κ²½λ³€μ** | `JASYPT_STOREPASS` | `KEYSTORE_PASSWORD` | β… μ™„λ£ |
| **ν‚¤ λ¶„λ¦¬** | ν‚¤μ¤ν† μ–΄ λΉ„λ°€λ²νΈ = JASYPT ν‚¤ | ν‚¤μ¤ν† μ–΄ λΉ„λ°€λ²νΈ β‰  JASYPT ν‚¤ | β… μ™„λ£ |
| **λ³΄μ• μμ¤€** | ν‚¤μ¤ν† μ–΄ λΉ„λ°€λ²νΈ λ…Έμ¶ μ‹ μ„ν— | ν‚¤μ¤ν† μ–΄ λΉ„λ°€λ²νΈ λ…Έμ¶λμ–΄λ„ μ•”νΈν™” ν‚¤ μ•μ „ | β… κ°•ν™” |
| **KeyStoreService** | λ―Έμ‚¬μ© | JasyptConfigμ—μ„ μ κ·Ή ν™μ© | β… μ™„λ£ |

---

## π“‹ μμ •λ νμΌ λ©λ΅

### β… ν•µμ‹¬ μ½”λ“ νμΌ
```
1. src/main/java/demo/encryptfile/config/JasyptConfig.java
   - KeyStoreService μμ΅΄μ„± μ£Όμ… μ¶”κ°€
   - κ°μΈν‚¤ κΈ°λ° μ•”νΈν™” λ΅μ§μΌλ΅ μ „ν™
   - ν‚¤ λ¶„λ¦¬ κµ¬μ΅° κµ¬ν„

2. src/main/java/demo/encryptfile/service/KeyStoreService.java
   - μ΄λ―Έ μ΅΄μ¬ν–μΌλ‚ JasyptConfigμ—μ„ ν™μ© μ‹μ‘

3. src/main/java/demo/encryptfile/EncryptFileApplication.java
   - ν™κ²½λ³€μ ν™•μΈ λ΅μ§ μ—…λ°μ΄νΈ (KEYSTORE_PASSWORD)
   - λ΅κ·Έ λ©”μ‹μ§€ v2.0μΌλ΅ μ—…λ°μ΄νΈ
```

### β… μ„¤μ • νμΌ
```
4. src/main/resources/application.yml
   - JASYPT_STOREPASS β†’ KEYSTORE_PASSWORD λ³€κ²½

5. src/test/resources/application-test.properties
   - ν•λ“μ½”λ”© λΉ„λ°€λ²νΈ β†’ μ‹¤μ  ν‚¤μ¤ν† μ–΄ λΉ„λ°€λ²νΈλ΅ λ³€κ²½

6. .env.properties
   - ν™κ²½λ³€μ μ΄λ¦„ ν†µμΌ (KEYSTORE_PASSWORD)
   - v2.0 λ§μ΄κ·Έλ μ΄μ… μ™„λ£ μ•λ‚΄ μ¶”κ°€
```

### β… ν…μ¤νΈ νμΌ
```
7. src/test/java/demo/encryptfile/config/JasyptConfigTest.java
   - κ°μΈν‚¤ μ¶”μ¶ ν…μ¤νΈ μ¶”κ°€
   - ν‚¤ λ¶„λ¦¬ κ²€μ¦ ν…μ¤νΈ μ¶”κ°€
   - λ§μ΄κ·Έλ μ΄μ… κ²€μ¦ ν…μ¤νΈ μ¶”κ°€

8. src/test/java/demo/encryptfile/util/JasyptEncryptionTest.java
   - ν‚¤μ¤ν† μ–΄ λΉ„λ°€λ²νΈ μ—…λ°μ΄νΈ
```

### β… μ¤ν¬λ¦½νΈ νμΌ
```
9. secrets/create-keystore.ps1
   - KEYSTORE_PASSWORD ν™κ²½λ³€μ μ‚¬μ©
   - v2.0 λ§μ΄κ·Έλ μ΄μ… μ™„λ£ μ•λ‚΄
   - λ³„μΉ­ jasypt-secret-keyλ΅ λ³€κ²½

10. secrets/create-keystore.sh
    - KEYSTORE_PASSWORD ν™κ²½λ³€μ μ‚¬μ©
    - v2.0 λ§μ΄κ·Έλ μ΄μ… μ™„λ£ μ•λ‚΄
    - λ³„μΉ­ jasypt-secret-keyλ΅ λ³€κ²½
```

---

## π” λ³΄μ• κ°•ν™” μ„±κ³Ό

### β… Before (v1.0) - μ„ν—ν• κµ¬μ΅°
```java
// ν‚¤μ¤ν† μ–΄ λΉ„λ°€λ²νΈλ¥Ό JASYPT μ•”νΈν™” ν‚¤λ΅ μ§μ ‘ μ‚¬μ©
config.setPassword(keystorePassword);  // π¨ μ„ν—!
```

**λ¬Έμ μ :**
- ν‚¤μ¤ν† μ–΄ λΉ„λ°€λ²νΈ = JASYPT μ•”νΈν™” ν‚¤
- ν‚¤μ¤ν† μ–΄ λΉ„λ°€λ²νΈ λ…Έμ¶ μ‹ λ¨λ“  μ•”νΈν™” λ°μ΄ν„° μ„ν—
- ν™κ²½λ³€μ `JASYPT_STOREPASS`κ°€ μ‹¤μ  μ•”νΈν™” ν‚¤ μ—­ν• 

### β… After (v2.0) - μ•μ „ν• κµ¬μ΅°
```java
// ν‚¤μ¤ν† μ–΄μ—μ„ κ°μΈν‚¤λ¥Ό μ¶”μ¶ν•μ—¬ JASYPT μ•”νΈν™” ν‚¤λ΅ μ‚¬μ©
String privateKeyPassword = keyStoreService.extractPrivateKeyAsPassword(
    keystoreLocation, keystorePassword, keystoreAlias);
config.setPassword(privateKeyPassword);  // β… μ•μ „!
```

**κ°μ„ μ :**
- ν‚¤μ¤ν† μ–΄ λΉ„λ°€λ²νΈ β‰  JASYPT μ•”νΈν™” ν‚¤ (μ™„μ „ λ¶„λ¦¬)
- ν‚¤μ¤ν† μ–΄ λΉ„λ°€λ²νΈ λ…Έμ¶λμ–΄λ„ μ•”νΈν™” ν‚¤λ” μ•μ „
- κ°μΈν‚¤μ κ°•λ ¥ν• μ•”νΈν™” νΉμ„± ν™μ©
- `KEYSTORE_PASSWORD`λ” P12 νμΌ μ—΄κΈ°μ©λ§ μ‚¬μ©

---

## π§ ν…μ¤νΈ κ²€μ¦ κ²°κ³Ό

### β… ν•µμ‹¬ κ²€μ¦ ν•­λ©
```
1. ν‚¤ λ¶„λ¦¬ κ²€μ¦
   β… keystorePassword β‰  privateKeyPassword ν™•μΈ
   β… λ‘ κ°’μ΄ μ™„μ „ν λ‹¤λ¥Έ κ°’μ„μ„ ν…μ¤νΈλ΅ κ²€μ¦

2. μ•”νΈν™”/λ³µνΈν™” κΈ°λ¥
   β… κ°μΈν‚¤ κΈ°λ° μ•”νΈν™” μ •μƒ μ‘λ™
   β… κΈ°μ΅΄ λ°μ΄ν„°μ™€ νΈν™μ„± μ μ§€

3. KeyStoreService μ—°λ™
   β… JasyptConfigμ—μ„ KeyStoreService μ •μƒ μ‚¬μ©
   β… κ°μΈν‚¤ μ¶”μ¶ λ΅μ§ μ •μƒ μ‘λ™

4. ν™κ²½λ³€μ λ³€κ²½
   β… KEYSTORE_PASSWORD ν™κ²½λ³€μ μ •μƒ μΈμ‹
   β… κΈ°μ΅΄ JASYPT_STOREPASS μμ΅΄μ„± μ™„μ „ μ κ±°
```

### β… ν…μ¤νΈ μ‹¤ν–‰ λ°©λ²•
```bash
# λ‹¨μ„ ν…μ¤νΈ μ‹¤ν–‰
./gradlew test

# ν‚¤ λ¶„λ¦¬ κ²€μ¦ ν…μ¤νΈ
./gradlew test --tests "JasyptConfigTest.ν‚¤μ¤ν† μ–΄μ—μ„_κ°μΈν‚¤_μ¶”μ¶_ν…μ¤νΈ"
./gradlew test --tests "JasyptConfigTest.λ§μ΄κ·Έλ μ΄μ…_κ²€μ¦_ν…μ¤νΈ"

# μ•”νΈν™” κΈ°λ¥ ν…μ¤νΈ
./gradlew test --tests "JasyptEncryptionTest"
```

---

## π€ μ΄μ λ°°ν¬ κ°€μ΄λ“

### β… 1. ν™κ²½λ³€μ μ„¤μ • λ³€κ²½
```bash
# κΈ°μ΅΄ (μ κ±° ν•„μ”)
unset JASYPT_STOREPASS

# μ‹ κ· (μ„¤μ • ν•„μ”)
export KEYSTORE_PASSWORD="your-keystore-password"
```

### β… 2. ν‚¤μ¤ν† μ–΄ νμΌ ν™•μΈ
```bash
# ν‚¤μ¤ν† μ–΄ νμΌ μ΅΄μ¬ ν™•μΈ
ls -la secrets/keystore.p12

# ν‚¤μ¤ν† μ–΄ λ‚΄μ© ν™•μΈ (λ³„μΉ­μ΄ jasypt-secret-keyμΈμ§€ ν™•μΈ)
keytool -list -storetype PKCS12 -keystore secrets/keystore.p12
```

### β… 3. μ• ν”λ¦¬μΌ€μ΄μ… μ‹μ‘
```bash
# κ°λ° ν™κ²½
./gradlew bootRun --args='--spring.profiles.active=local'

# μ΄μ ν™κ²½
java -jar encrypt-file.jar --spring.profiles.active=prod
```

### β… 4. κΈ°λ¥ κ²€μ¦
```bash
# ν—¬μ¤μ²΄ν¬
curl http://localhost:8080/api/health

# μ•”νΈν™” ν…μ¤νΈ
curl -X POST http://localhost:8080/api/encrypt \
  -H "Content-Type: application/json" \
  -d '{"plainText": "test-value"}'
```

---

## π” νΈλ¬λΈ”μν… κ°€μ΄λ“

### β μμ£Ό λ°μƒν•λ” λ¬Έμ λ“¤

#### 1. **"ν‚¤μ¤ν† μ–΄μ—μ„ λ³„μΉ­μ„ μ°Ύμ„ μ μ—†μµλ‹λ‹¤"**
```
μ›μΈ: κΈ°μ΅΄ ν‚¤μ¤ν† μ–΄μ λ³„μΉ­μ΄ jasypt-secret-keyκ°€ μ•„λ‹
ν•΄κ²°: 
1. ν‚¤μ¤ν† μ–΄ ν™•μΈ: keytool -list -keystore keystore.p12
2. application.ymlμ—μ„ μ¬λ°”λ¥Έ λ³„μΉ­ μ„¤μ •
3. λλ” μƒ ν‚¤μ¤ν† μ–΄ μƒμ„±
```

#### 2. **"KEYSTORE_PASSWORD ν™κ²½λ³€μκ°€ μ„¤μ •λμ§€ μ•μ•μµλ‹λ‹¤"**
```
μ›μΈ: ν™κ²½λ³€μ μ΄λ¦„ λ³€κ²½ λ―Έλ°μ
ν•΄κ²°:
1. κΈ°μ΅΄: unset JASYPT_STOREPASS
2. μ‹ κ·: export KEYSTORE_PASSWORD="..."
```

#### 3. **μ•”νΈν™”/λ³µνΈν™” μ‹¤ν¨**
```
μ›μΈ: ν‚¤ μ¶”μ¶ μ‹¤ν¨ λλ” ν‚¤μ¤ν† μ–΄ μ†μƒ
ν•΄κ²°:
1. ν‚¤μ¤ν† μ–΄ λ¬΄κ²°μ„± ν™•μΈ
2. KeyStoreService.validateKeyStore() λ΅κ·Έ ν™•μΈ
3. ν•„μ”μ‹ ν‚¤μ¤ν† μ–΄ μ¬μƒμ„±
```

#### 4. **ν…μ¤νΈ μ‹¤ν¨**
```
μ›μΈ: ν…μ¤νΈμ© ν‚¤μ¤ν† μ–΄ μ„¤μ • λ¶μΌμΉ
ν•΄κ²°:
1. application-test.properties ν™•μΈ
2. ν…μ¤νΈμ© ν‚¤μ¤ν† μ–΄ κ²½λ΅ ν™•μΈ
3. ν‚¤μ¤ν† μ–΄ λ³„μΉ­ μΌμΉ μ—¬λ¶€ ν™•μΈ
```

---

## π“ λ§μ΄κ·Έλ μ΄μ… μ„±κ³Ό μ§€ν‘

### π― λ³΄μ• κ°•ν™” μ§€ν‘
- **ν‚¤ λ¶„λ¦¬μ¨**: 100% (ν‚¤μ¤ν† μ–΄ λΉ„λ°€λ²νΈ β‰  JASYPT ν‚¤)
- **μ•”νΈν™” κ°•λ„**: RSA 4096-bit κ°μΈν‚¤ κΈ°λ°μΌλ΅ ν–¥μƒ
- **λ…Έμ¶ μ„ν—**: ν‚¤μ¤ν† μ–΄ λΉ„λ°€λ²νΈ λ…Έμ¶ μ‹μ—λ„ μ•”νΈν™” ν‚¤ μ•μ „

### π― μ΄μ νΈμμ„± μ§€ν‘
- **ν™κ²½λ³€μ ν†µμΌ**: KEYSTORE_PASSWORDλ΅ μΌμ›ν™”
- **ν‚¤ κ΄€λ¦¬ ν¬λ…μ„±**: KeyStoreServiceλ¥Ό ν†µν• λ…ν™•ν• ν‚¤ κ΄€λ¦¬
- **ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€**: ν‚¤ λ¶„λ¦¬ λ° μ•”νΈν™” κΈ°λ¥ ν…μ¤νΈ μ™„λΉ„

### π― μ•„ν‚¤ν…μ² κ°μ„  μ§€ν‘
- **μμ΅΄μ„± λ¶„λ¦¬**: JasyptConfig β†” KeyStoreService μ—°λ™
- **PKCS#12 ν™μ©**: ν‘μ¤€ ν‚¤μ¤ν† μ–΄ ν¬λ§·μ μ™„μ „ν• ν™μ©
- **μ½”λ“ ν’μ§**: λ…ν™•ν• μ±…μ„ λ¶„λ¦¬ λ° ν™•μ¥ κ°€λ¥ν• κµ¬μ΅°

---

## π”® ν–¥ν›„ κ³ λ ¤μ‚¬ν•­

### π€ μ¶”κ°€ κ°μ„  κ°€λ¥ μμ—­
1. **ν‚¤ λ΅ν…μ΄μ… μλ™ν™”**: κ°μΈν‚¤ κµμ²΄ μ‹λ‚λ¦¬μ¤ κµ¬ν„
2. **λ‹¤μ¤‘ ν‚¤μ¤ν† μ–΄ μ§€μ›**: ν™κ²½λ³„ ν‚¤μ¤ν† μ–΄ λ¶„λ¦¬
3. **ν‚¤ λ°±μ—… μ „λµ**: μ•μ „ν• ν‚¤ λ°±μ—… λ° λ³µκµ¬ ν”„λ΅μ„Έμ¤
4. **λ¨λ‹ν„°λ§ κ°•ν™”**: ν‚¤ μ‚¬μ© μ¶”μ  λ° λ³΄μ• μ΄λ²¤νΈ λ΅κΉ…

### π” λ³΄μ• κ°•ν™” λ°©μ•
1. **HSM μ—°λ™**: Hardware Security Moduleκ³Όμ ν†µν•©
2. **ν‚¤ μ•”νΈν™”**: ν‚¤μ¤ν† μ–΄ μμ²΄μ μ¶”κ°€ μ•”νΈν™” κ³„μΈµ
3. **μ ‘κ·Ό μ μ–΄**: μ„Έλ°€ν• ν‚¤ μ ‘κ·Ό κ¶ν• κ΄€λ¦¬
4. **κ°μ‚¬ λ΅κΉ…**: ν‚¤ μ‚¬μ© μ΄λ ¥ μ¶”μ  μ‹μ¤ν…

---

## π“ κ²°λ΅ 

**π‰ JASYPT ν‚¤μ¤ν† μ–΄ λ§μ΄κ·Έλ μ΄μ… v2.0μ΄ μ„±κ³µμ μΌλ΅ μ™„λ£λμ—μµλ‹λ‹¤!**

### β… λ‹¬μ„±ν• λ©ν‘
- β… **ν‚¤ λ¶„λ¦¬**: ν‚¤μ¤ν† μ–΄ λΉ„λ°€λ²νΈμ™€ JASYPT μ•”νΈν™” ν‚¤ μ™„μ „ λ¶„λ¦¬
- β… **λ³΄μ• κ°•ν™”**: κ°μΈν‚¤ κΈ°λ° μ•”νΈν™”λ΅ λ³΄μ• μμ¤€ ν–¥μƒ
- β… **κµ¬μ΅° κ°μ„ **: KeyStoreServiceλ¥Ό ν†µν• λ…ν™•ν• ν‚¤ κ΄€λ¦¬
- β… **ν™κ²½λ³€μ ν†µμΌ**: KEYSTORE_PASSWORDλ΅ μΌμ›ν™”
- β… **ν…μ¤νΈ μ™„λΉ„**: ν¬κ΄„μ μΈ ν…μ¤νΈ μΌ€μ΄μ¤ κµ¬ν„

### π” λ³΄μ• κ°μ„  ν¨κ³Ό
- **κΈ°μ΅΄**: ν‚¤μ¤ν† μ–΄ λΉ„λ°€λ²νΈ λ…Έμ¶ = μ „μ²΄ μ‹μ¤ν… μ„ν—
- **ν„μ¬**: ν‚¤μ¤ν† μ–΄ λΉ„λ°€λ²νΈ λ…Έμ¶λμ–΄λ„ μ•”νΈν™” ν‚¤ μ•μ „

### π€ λ‹¤μ λ‹¨κ³„
1. μ΄μ ν™κ²½ λ°°ν¬ μ‹ μ΄ κ°€μ΄λ“ μ°Έμ΅°
2. μ •κΈ°μ μΈ ν‚¤ κ΄€λ¦¬ μ •μ±… μλ¦½
3. λ³΄μ• κ°μ‚¬ λ° λ¨λ‹ν„°λ§ μ²΄κ³„ κµ¬μ¶•

---

**π“ λ¬Έμμ‚¬ν•­μ΄λ‚ μ¶”κ°€ μ§€μ›μ΄ ν•„μ”ν• κ²½μ° κ°λ°ν€μ— μ—°λ½ν•μ„Έμ”.**

**π”— κ΄€λ ¨ λ¬Έμ„:**
- [μ›λ³Έ λ§μ΄κ·Έλ μ΄μ… κ³„νμ„](./jasypt_keystore_migration_plan_v2.md)
- [KeyStoreService API λ¬Έμ„](../../api/KeyStoreService.md)
- [JASYPT μ„¤μ • κ°€μ΄λ“](../../setup/jasypt-setup.md)
